<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MG Transporte - Sistema de Viajes Puerta a Puerta</title>
<!-- CDN de Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<!-- Íconos de Lucide -->
<script src="https://unpkg.com/lucide@latest"></script>
<style>
body {
font-family: 'Inter', sans-serif;
background-color: #f7f9fb;
}
/* Colores personalizados */
.color-primary { color: #5B48B3; }
.bg-primary { background-color: #5B48B3; }
.border-primary { border-color: #5B48B3; }
.color-accent { color: #ff8c00; }
.bg-accent { background-color: #ff8c00; }
.ring-accent:focus { --tw-ring-color: #ff8c00; }

.tab-button.active {
border-bottom: 3px solid #ff8c00;
color: #5B48B3;
font-weight: 600;
}
.modal-tab-button.active {
border-bottom: 3px solid #ff8c00;
color: #5B48B3;
font-weight: 600;
}
.route-status-card {
border-left: 4px solid #ff8c00;
}

/* Sub-pestañas (Genéricas) */
.sub-tab-button {
padding: 8px 16px;
border-bottom: 3px solid transparent;
color: #6b7280;
font-weight: 500;
}
.sub-tab-button.active {
border-bottom-color: #5B48B3;
color: #5B48B3;
font-weight: 600;
}

/* Feedback de Botón */
.btn-feedback {
transition: all 0.1s ease;
}
.btn-feedback:active {
transform: scale(0.98);
opacity: 0.9;
}
/* Deshabilitado */
.btn-feedback:disabled {
transform: scale(1);
opacity: 0.7;
cursor: not-allowed;
}


/* Estilo para el Ticket en el Modal */
.printable-ticket {
font-family: 'Inter', sans-serif;
border: 1px solid #e5e7eb;
border-radius: 0.5rem;
background: #ffffff;
padding: 1.5rem;
}
.printable-ticket h4 {
font-size: 1.125rem;
font-weight: 700;
color: #5B48B3;
border-bottom: 2px solid #f3f4f6;
padding-bottom: 0.5rem;
margin-bottom: 1rem;
display: flex;
align-items: center;
}
.printable-ticket .section-title {
font-size: 0.75rem;
font-weight: 600;
color: #6b7280;
text-transform: uppercase;
letter-spacing: 0.05em;
margin-bottom: 0.25rem;
}
.printable-ticket p {
font-size: 0.9rem;
color: #1f2937;
margin-bottom: 0.5rem;
}
.printable-ticket .highlight {
font-size: 1rem;
font-weight: 600;
color: #166534; /* Green */
}
.printable-ticket .pending {
font-size: 0.9rem;
font-weight: 600;
color: #b45309; /* Amber */
}
.printable-ticket .icon {
width: 1rem;
height: 1rem;
margin-right: 0.5rem;
stroke: #5B48B3;
}

/* Estilo para el resumen de Gemini */
.gemini-summary {
background-color: #fdfdea; /* Amarillo pálido */
border: 1px solid #fbf0c0;
border-radius: 0.5rem;
padding: 1rem;
margin-top: 1rem;
margin-bottom: 1rem;
font-size: 0.9rem;
color: #725a03;
}
.gemini-summary p {
margin-bottom: 0.5rem;
color: #725a03;
}
.gemini-summary strong {
color: #5a4802;
}
.gemini-summary ul {
list-style-type: disc;
padding-left: 1.25rem;
}
.gemini-summary-title {
font-weight: 700;
display: flex;
align-items: center;
color: #5a4802;
margin-bottom: 0.5rem;
}
.gemini-summary-title svg {
width: 1rem;
height: 1rem;
margin-right: 0.5rem;
stroke: #725a03;
}


/* Ocultar elementos en la impresión */
@media print {
body * {
visibility: hidden;
}
#printable-area, #printable-area * {
visibility: visible;
}
#printable-area {
position: absolute;
left: 0;
top: 0;
width: 100%;
/* Ajustes para asegurar que se imprima correctamente */
padding: 0;
margin: 0;
border: none;
box-shadow: none;
max-height: none !important; /* Importante para que no corte */
overflow: visible !important;
}
#ticket-modal {
/* Asegurar que el modal no interfiera */
position: relative;
background: none;
inset: auto;
}
#ticket-modal > div { /* Contenedor del modal */
max-height: none !important; /* Importante */
overflow: visible !important;
box-shadow: none;
border: none;
padding: 0;
margin: 0;
background: none;
}
.modal-actions-no-print,
#close-modal-btn,
#ticket-modal .flex.border-b { /* Ocultar botones y pestañas del modal */
display: none;
}
.printable-ticket {
box-shadow: none;
border: 1px solid #ccc; /* Añadir un borde sutil para impresión */
width: 100%; /* Asegurar ancho completo */
margin: 0;
padding: 10px; /* Ajustar padding si es necesario */
}
.gemini-summary {
background-color: #ffffff;
border: 1px solid #eeeeee;
}
/* Ocultar barras de scroll si las hubiera */
body {
overflow: visible !important;
}
}
</style>
</head>
<body class="min-h-screen bg-gray-100">

<!-- Contenedor de Login -->
<div id="login-container" class="flex items-center justify-center min-h-screen p-4">
<div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-sm">
<div class="flex items-center justify-center h-12 w-12 mx-auto rounded-full bg-primary text-white text-lg font-bold mb-4">
MG
</div>
<h2 class="text-2xl font-bold text-center text-gray-800 mb-6">Iniciar Sesión</h2>
<form id="login-form">
<div class="mb-4">
<label for="login-email" class="block text-sm font-medium text-gray-700">Email</label>
<input type="email" id="login-email" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary" required>
</div>
<div class="mb-6">
<label for="login-password" class="block text-sm font-medium text-gray-700">Contraseña</label>
<input type="password" id="login-password" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary" required>
</div>
<div id="login-error" class="text-red-500 text-sm mb-4 text-center hidden"></div>
<button type="submit" id="login-btn" class="w-full bg-primary hover:bg-opacity-90 text-white font-semibold py-3 rounded-xl transition duration-150 shadow-lg shadow-purple-200/50 btn-feedback flex items-center justify-center">
Ingresar
</button>
</form>
</div>
</div>

<!-- Contenedor Principal de la App (Oculto por defecto) -->
<div id="app" class="max-w-5xl mx-auto p-4 md:p-8 hidden">
<header class="text-center mb-6">
<h1 class="text-3xl font-bold text-gray-800 flex items-center justify-center">
<span class="color-primary">MG Transporte</span>
</h1>
<p class="text-sm text-gray-500 mt-1">Sistema de Viajes Puerta a Puerta</p>
<!-- Estado de Auth y Botón de Salir -->
<div class="flex items-center justify-center gap-4 mt-4">
<div id="auth-status" class="text-center text-xs text-gray-500">Conectando...</div>
<button id="logout-btn" class="hidden bg-red-500 hover:bg-red-600 text-white text-xs font-semibold py-1 px-3 rounded-full btn-feedback">
Cerrar Sesión
</button>
</div>
</header>

<!-- Mensajes de estado -->
<div id="status-message" class="hidden p-3 mb-4 text-sm rounded-lg" role="alert"></div>

<!-- Navegación de Pestañas -->
<div class="flex border-b border-gray-200 mb-6 text-sm overflow-x-auto">
<button id="tab-viajes" class="tab-button active flex-1 py-3 px-1 text-center text-gray-600 transition duration-150 whitespace-nowrap btn-feedback">
<i data-lucide="ticket" class="w-4 h-4 inline-block mr-1"></i> Tickets de Viaje
</button>
<button id="tab-rutas" class="tab-button flex-1 py-3 px-1 text-center text-gray-600 transition duration-150 whitespace-nowrap btn-feedback">
<i data-lucide="list-checks" class="w-4 h-4 inline-block mr-1"></i> Rutas (Asignación)
</button>
<button id="tab-clientes" class="tab-button flex-1 py-3 px-1 text-center text-gray-600 transition duration-150 whitespace-nowrap btn-feedback">
<i data-lucide="contact" class="w-4 h-4 inline-block mr-1"></i> Clientes
</button>
<button id="tab-vehiculos" class="tab-button flex-1 py-3 px-1 text-center text-gray-600 transition duration-150 whitespace-nowrap btn-feedback">
<i data-lucide="car" class="w-4 h-4 inline-block mr-1"></i> Vehículos
</button>
<button id="tab-choferes" class="tab-button flex-1 py-3 px-1 text-center text-gray-600 transition duration-150 whitespace-nowrap btn-feedback">
<i data-lucide="users" class="w-4 h-4 inline-block mr-1"></i> Choferes
</button>
</div>

<!-- 1. Contenido de VIAJES (Tickets individuales) -->
<div id="content-viajes" class="tab-content">
<!-- Formulario de Viaje -->
<div class="bg-white p-6 rounded-xl shadow-lg mb-6">
<h2 class="text-xl font-semibold mb-4 text-gray-700">Registrar Nuevo Ticket de Viaje</h2>
<form id="trip-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
<input type="hidden" id="editing-trip-id">
<!-- Cliente y Datos Básicos -->
<div class="md:col-span-2 grid grid-cols-2 gap-4">
<div>
<label class="block text-sm font-medium text-gray-700">Cliente / Pasajero</label>
<input type="text" id="client-name" placeholder="Nombre completo" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary" required>
</div>
<div>
<label class="block text-sm font-medium text-gray-700">Teléfono del cliente</label>
<input type="text" id="client-phone" placeholder="Teléfono (clave para guardar cliente)" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary" required>
</div>
</div>
<!-- Origen (Salida) -->
<div class="p-3 border rounded-lg bg-red-50 border-red-200">
<p class="font-bold text-red-700 text-sm mb-2">SALIDA (Origen)</p>
<label class="block text-xs font-medium text-gray-700">Dirección Salida</label>
<input type="text" id="address-origin" placeholder="Dirección" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary" required>
<label class="block text-xs font-medium text-gray-700 mt-2">Localidad Salida</label>
<input type="text" id="locality-origin" placeholder="Localidad" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary" required>
</div>

<!-- Destino -->
<div class="p-3 border rounded-lg bg-green-50 border-green-200">
<p class="font-bold text-green-700 text-sm mb-2">DESTINO</p>
<label class="block text-xs font-medium text-gray-700">Dirección Destino</label>
<input type="text" id="address-dest" placeholder="Dirección" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary" required>
<label class="block text-xs font-medium text-gray-700 mt-2">Localidad Destino</label>
<input type="text" id="locality-dest" placeholder="Localidad" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary" required>
</div>

<!-- Fecha, Hora y Precio -->
<div>
<label class="block text-sm font-medium text-gray-700">Fecha de viaje</label>
<input type="date" id="trip-date" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary" required>
</div>
<div>
<label class="block text-sm font-medium text-gray-700">Hora Aprox.</label>
<input type="time" id="trip-time" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary" required>
</div>

<!-- Pasajeros y Mascotas -->
<div class="md:col-span-2 grid grid-cols-3 gap-4">
<div>
<label class="block text-sm font-medium text-gray-700">Pasajeros</label>
<input type="number" id="trip-passengers" value="1" min="1" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary" required>
</div>
<div>
<label class="block text-sm font-medium text-gray-700">Mascotas (Cant)</label>
<input type="number" id="trip-pets" value="0" min="0" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary" required>
</div>
<div>
<label class="block text-sm font-medium text-gray-700">Tamaño Mascota</label>
<select id="trip-pet-size" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary">
<option value="ninguno">Ninguno</option>
<option value="<5kg">Pequeño (&lt;5kg)</option>
<option value=">5kg">Grande (&gt;5kg)</option>
</select>
</div>
</div>

<div class="md:col-span-2">
<label class="block text-sm font-medium text-gray-700">Precio Final</label>
<input type="number" id="trip-price" placeholder="Precio final del viaje" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary" required>
</div>

<div class="md:col-span-2 mt-4 flex space-x-3">
<button type="submit" id="save-trip-btn" class="w-full bg-primary hover:bg-opacity-90 text-white font-semibold py-3 rounded-xl transition duration-150 shadow-lg shadow-purple-200/50 flex items-center justify-center btn-feedback">
<i data-lucide="plus-circle" class="w-5 h-5 mr-2"></i> Registrar Ticket
</button>
<button type="button" id="cancel-edit-btn" class="w-1/3 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 rounded-xl transition duration-150 hidden btn-feedback">
Cancelar Edición
</button>
</div>
</form>
</div>

<!-- Listado de Viajes (Boletos) con Sub-Pestañas -->
<div class="bg-white p-6 rounded-xl shadow-lg">
<!-- Sub-pestañas -->
<div class="flex border-b border-gray-200 mb-4">
<button id="sub-tab-activos" class="sub-tab-button active btn-feedback">
<i data-lucide="activity" class="w-4 h-4 inline-block mr-1"></i> Activos
</button>
<button id="sub-tab-finalizados" class="sub-tab-button btn-feedback">
<i data-lucide="check-circle" class="w-4 h-4 inline-block mr-1"></i> Finalizados
</button>
</div>

<!-- Contenido Pestaña Activos -->
<div id="content-activos" class="sub-tab-content">
<h2 class="text-xl font-semibold mb-4 text-gray-700">Tickets Pendientes y Asignados</h2>
<div id="trips-list-active" class="space-y-4">
<p class="text-center text-gray-500" id="loading-trips-active">Cargando tickets activos...</p>
</div>
</div>

<!-- Contenido Pestaña Finalizados -->
<div id="content-finalizados" class="sub-tab-content hidden">
<h2 class="text-xl font-semibold mb-4 text-gray-700">Tickets Finalizados</h2>
<div id="trips-list-finished" class="space-y-4">
<p class="text-center text-gray-500" id="loading-trips-finished">Cargando tickets finalizados...</p>
</div>
</div>
</div>
</div>

<!-- 2. Contenido de RUTAS (Asignación) -->
<div id="content-rutas" class="tab-content hidden">
<div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
<!-- Columna 1: Crear/Ver Rutas -->
<div class="xl:col-span-1">
<!-- Formulario Crear/Editar Ruta (Ajustado para Scroll) -->
<div class="bg-white p-6 rounded-xl shadow-lg mb-6 sticky top-4 max-h-[calc(100vh-4rem)] overflow-y-auto">
<h2 class="text-xl font-semibold mb-4 text-gray-700" id="route-form-title">Crear Nueva Ruta</h2>
<form id="route-form">
<input type="hidden" id="editing-route-id">
<div class="space-y-4">
<div>
<label class="block text-sm font-medium text-gray-700">Asignar Chofer</label>
<select id="route-driver-id" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary" required>
<option value="">-- Seleccionar Chofer --</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700">Asignar Vehículo</label>
<select id="route-vehicle-id" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary" required>
<option value="">-- Seleccionar Vehículo --</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700">Fecha de Ruta</label>
<input type="date" id="route-date" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:ring-4 ring-accent focus:border-primary" required>
</div>
</div>
<div class="mt-6 space-y-3">
<button type="submit" id="save-route-btn" class="w-full bg-accent hover:bg-opacity-90 text-white font-semibold py-3 rounded-xl transition duration-150 shadow-lg shadow-yellow-200/50 flex items-center justify-center btn-feedback">
<i data-lucide="plus-square" class="w-5 h-5 mr-2"></i> Crear Ruta Vacía
</button>
<button type="button" id="cancel-route-edit-btn" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 rounded-xl transition duration-150 flex items-center justify-center btn-feedback hidden">
Cancelar Edición
</button>
</div>
</form>
</div>

<!-- Listado de Rutas (con Sub-Pestañas) -->
<div class="bg-white p-6 rounded-xl shadow-lg">
<!-- Sub-pestañas -->
<div class="flex border-b border-gray-200 mb-4">
<button id="sub-tab-rutas-activas" class="sub-tab-button active btn-feedback">
<i data-lucide="activity" class="w-4 h-4 inline-block mr-1"></i> Activas
</button>
<button id="sub-tab-rutas-finalizadas" class="sub-tab-button btn-feedback">
<i data-lucide="check-circle" class="w-4 h-4 inline-block mr-1"></i> Finalizadas
</button>
</div>

<!-- Contenido Pestaña Rutas Activas -->
<div id="content-rutas-activas" class="sub-tab-content">
<h3 class="font-semibold text-gray-700 mb-3">Rutas Activas</h3>
<div id="active-routes-list" class="space-y-3">
<p class="text-center text-xs text-gray-400" id="loading-routes-active">Cargando rutas activas...</p>
</div>
</div>

<!-- Contenido Pestaña Rutas Finalizadas -->
<div id="content-rutas-finalizadas" class="sub-tab-content hidden">
<h3 class="font-semibold text-gray-700 mb-3">Rutas Finalizadas</h3>
<div id="finished-routes-list" class="space-y-3">
<p class="text-center text-xs text-gray-400" id="loading-routes-finished">Cargando rutas finalizadas...</p>
</div>
</div>
</div>
</div>

<!-- Columna 2 y 3: Detalles de Ruta y Viajes Pendientes -->
<div class="xl:col-span-2">
<!-- Detalle de la Ruta Seleccionada -->
<div class="bg-white p-6 rounded-xl shadow-lg mb-6">
<h2 class="text-xl font-semibold mb-4 text-gray-700 flex justify-between items-center">
Detalle de Ruta <span id="route-id-display" class="text-sm text-gray-500 font-mono"></span>
</h2>
<div id="route-details-info" class="p-4 bg-gray-50 rounded-lg">
<!-- Contenido dinámico -->
<p class="text-center text-gray-500">Selecciona una ruta activa para ver sus detalles.</p>
</div>
<h3 class="font-semibold text-gray-700 mt-6 mb-3 flex items-center">
<i data-lucide="list-ordered" class="w-4 h-4 mr-2 color-primary"></i> Tramos Asignados
</h3>
<div id="assigned-trips-list" class="space-y-3">
<p class="text-center text-gray-500 text-sm">Selecciona una ruta activa para ver los viajes asignados.</p>
</div>
</div>

<!-- Viajes Pendientes -->
<div class="bg-white p-6 rounded-xl shadow-lg">
<h3 class="font-semibold text-gray-700 mb-4 flex items-center">
<i data-lucide="package-open" class="w-4 h-4 mr-2 color-accent"></i> Tickets Pendientes de Asignación
</h3>
<div id="pending-trips-list" class="space-y-3">
<p class="text-center text-gray-500 text-sm" id="loading-pending-trips">Cargando tickets pendientes...</p>
</div>
</div>
</div>
</div>
</div>

<!-- 3. Contenido de CLIENTES -->
<div id="content-clientes" class="tab-content hidden">
<div class="bg-white p-6 rounded-xl shadow-lg">
<h2 class="text-xl font-semibold mb-4 text-gray-7

